<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selfie Frontend</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        .app-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="60" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>') repeat;
            opacity: 0.3;
        }
        .app-header h1 {
            margin: 0;
            border: none;
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }
        .app-header p {
            margin: 15px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }
        .nav-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        .nav-button:active {
            transform: translateY(0);
        }
        .page {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        .page.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
            font-size: 2rem;
        }
        .features {
            margin-top: 30px;
        }
        .features h3 {
            color: #555;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }
        .features ul {
            list-style: none;
            padding: 0;
        }
        .features li {
            margin: 12px 0;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            transition: all 0.2s ease;
        }
        .features li:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        .status-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid #2196f3;
            padding: 20px;
            margin: 25px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(33, 150, 243, 0.1);
        }
        .status-card h4 {
            margin: 0 0 10px 0;
            color: #1976d2;
            font-size: 1.1rem;
        }
        .coordination-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .agent-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #28a745;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .agent-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }
        .agent-card strong {
            display: block;
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 8px;
        }
        .agent-card small {
            color: #666;
            font-size: 0.9rem;
        }
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-header">
            <h1>ü§ñ Selfie Frontend</h1>
            <p>Agentic Build System Interface</p>
        </div>
        
        <alice-page></alice-page>
        <bob-page></bob-page>
    </div>

    <script>
        // Alice Page Component
        class AlicePage extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.render();
            }

            render() {
                this.shadowRoot.innerHTML = `
                    <style>
                        :host {
                            display: block;
                        }
                        :host(.hidden) {
                            display: none;
                        }
                        .page {
                            font-family: inherit;
                            animation: fadeIn 0.3s ease-in;
                        }
                        @keyframes fadeIn {
                            from { opacity: 0; transform: translateY(10px); }
                            to { opacity: 1; transform: translateY(0); }
                        }
                        .nav-button {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            margin: 10px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 16px;
                            font-weight: 600;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                        }
                        .nav-button:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
                        }
                        h1 {
                            color: #333;
                            border-bottom: 3px solid #667eea;
                            padding-bottom: 15px;
                            font-size: 2rem;
                        }
                        .features {
                            margin-top: 30px;
                        }
                        .features h3 {
                            color: #555;
                            font-size: 1.3rem;
                        }
                        .features ul {
                            list-style: none;
                            padding: 0;
                        }
                        .features li {
                            margin: 12px 0;
                            padding: 12px 15px;
                            background: #f8f9fa;
                            border-radius: 8px;
                            border-left: 4px solid #667eea;
                            transition: all 0.2s ease;
                        }
                        .features li:hover {
                            background: #e9ecef;
                            transform: translateX(5px);
                        }
                        .status-card {
                            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
                            border-left: 5px solid #2196f3;
                            padding: 20px;
                            margin: 25px 0;
                            border-radius: 8px;
                            box-shadow: 0 2px 10px rgba(33, 150, 243, 0.1);
                        }
                        .status-card h4 {
                            margin: 0 0 10px 0;
                            color: #1976d2;
                            font-size: 1.1rem;
                        }
                        .loading {
                            display: inline-block;
                            width: 12px;
                            height: 12px;
                            border: 2px solid #f3f3f3;
                            border-top: 2px solid #667eea;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                            margin-right: 8px;
                        }
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                    </style>
                    <div class="page" data-testid="alice-page">
                        <h1>üë©‚Äçüíª Alice's Dashboard</h1>
                        <p>Welcome to Alice's interface! Monitor and manage Selfie agent activities from here.</p>
                        
                        <div class="status-card">
                            <h4>üîó System Health</h4>
                            <p id="system-status"><span class="loading"></span>Checking connection...</p>
                        </div>
                        
                        <div class="status-card">
                            <h4>ü§ñ Agent Status</h4>
                            <p id="agent-status"><span class="loading"></span>Loading agent information...</p>
                        </div>
                        
                        <button class="nav-button" data-testid="go-to-bob-button" id="goToBobBtn">
                            üöÄ Switch to Bob's Coordination Center
                        </button>
                        
                        <div class="features">
                            <h3>Alice's Capabilities</h3>
                            <ul>
                                <li>üìä Monitor Selfie agent status and health</li>
                                <li>üéØ Create and track development tasks</li>
                                <li>üîå View active MCP server connections</li>
                                <li>üìù Manage GitHub issue integration</li>
                                <li>üîç Real-time system monitoring</li>
                            </ul>
                        </div>
                    </div>
                `;

                this.shadowRoot.getElementById('goToBobBtn').addEventListener('click', () => {
                    this.classList.add('hidden');
                    document.querySelector('bob-page').classList.remove('hidden');
                    history.pushState(null, '', '/bob');
                });

                // Initialize health checks
                this.checkSystemHealth();
                this.checkAgentStatus();
            }

            async checkSystemHealth() {
                try {
                    const response = await fetch('/api/health');
                    const data = await response.json();
                    const statusElement = this.shadowRoot.getElementById('system-status');
                    
                    if (response.ok) {
                        statusElement.innerHTML = `‚úÖ System Online - ${data.service} v${data.version}`;
                        statusElement.style.color = '#28a745';
                    } else {
                        statusElement.innerHTML = '‚ùå System Error - Connection failed';
                        statusElement.style.color = '#dc3545';
                    }
                } catch (error) {
                    const statusElement = this.shadowRoot.getElementById('system-status');
                    statusElement.innerHTML = '‚ö†Ô∏è Network Issue - Unable to connect';
                    statusElement.style.color = '#ffc107';
                }
            }

            async checkAgentStatus() {
                try {
                    const response = await fetch('/api/agents/status');
                    const data = await response.json();
                    const statusElement = this.shadowRoot.getElementById('agent-status');
                    
                    if (response.ok) {
                        const activeCount = data.agents.filter(a => a.status !== 'idle').length;
                        statusElement.innerHTML = `üü¢ ${activeCount}/${data.totalAgents} agents active, ${data.activeConnections} MCP connections`;
                        statusElement.style.color = '#28a745';
                    } else {
                        statusElement.innerHTML = '‚ùå Agent Status Unavailable';
                        statusElement.style.color = '#dc3545';
                    }
                } catch (error) {
                    const statusElement = this.shadowRoot.getElementById('agent-status');
                    statusElement.innerHTML = '‚ö†Ô∏è Unable to fetch agent data';
                    statusElement.style.color = '#ffc107';
                }
            }
        }

        // Bob Page Component
        class BobPage extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.classList.add('hidden');
                this.render();
            }

            render() {
                this.shadowRoot.innerHTML = `
                    <style>
                        :host {
                            display: block;
                        }
                        :host(.hidden) {
                            display: none;
                        }
                        .page {
                            font-family: inherit;
                            animation: fadeIn 0.3s ease-in;
                        }
                        @keyframes fadeIn {
                            from { opacity: 0; transform: translateY(10px); }
                            to { opacity: 1; transform: translateY(0); }
                        }
                        .nav-button {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            margin: 10px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 16px;
                            font-weight: 600;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                        }
                        .nav-button:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
                        }
                        h1 {
                            color: #333;
                            border-bottom: 3px solid #667eea;
                            padding-bottom: 15px;
                            font-size: 2rem;
                        }
                        .features {
                            margin-top: 30px;
                        }
                        .features h3 {
                            color: #555;
                            font-size: 1.3rem;
                        }
                        .features ul {
                            list-style: none;
                            padding: 0;
                        }
                        .features li {
                            margin: 12px 0;
                            padding: 12px 15px;
                            background: #f8f9fa;
                            border-radius: 8px;
                            border-left: 4px solid #667eea;
                            transition: all 0.2s ease;
                        }
                        .features li:hover {
                            background: #e9ecef;
                            transform: translateX(5px);
                        }
                        .coordination-panel {
                            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                            border: 1px solid #dee2e6;
                            border-radius: 12px;
                            padding: 25px;
                            margin: 25px 0;
                        }
                        .agent-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                            gap: 20px;
                            margin-top: 20px;
                        }
                        .agent-card {
                            background: white;
                            padding: 20px;
                            border-radius: 10px;
                            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
                            transition: all 0.3s ease;
                            border-left: 5px solid #28a745;
                        }
                        .agent-card:hover {
                            transform: translateY(-3px);
                            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
                        }
                        .agent-card.monitoring {
                            border-left-color: #ffc107;
                        }
                        .agent-card.available {
                            border-left-color: #28a745;
                        }
                        .agent-card.idle {
                            border-left-color: #6c757d;
                        }
                        .agent-card strong {
                            display: block;
                            font-size: 1.1rem;
                            color: #333;
                            margin-bottom: 8px;
                        }
                        .agent-card small {
                            color: #666;
                            font-size: 0.9rem;
                        }
                        .status-indicator {
                            display: inline-block;
                            width: 8px;
                            height: 8px;
                            border-radius: 50%;
                            margin-right: 6px;
                        }
                        .status-monitoring { background: #ffc107; }
                        .status-available { background: #28a745; }
                        .status-idle { background: #6c757d; }
                    </style>
                    <div class="page" data-testid="bob-page">
                        <h1>üß† Bob's Coordination Center</h1>
                        <p>Orchestrate and monitor the entire Selfie ecosystem from this central command interface.</p>
                        
                        <div class="coordination-panel">
                            <h4>ü§ñ Agent Coordination Dashboard</h4>
                            <div class="agent-grid" id="agent-grid">
                                <div class="agent-card monitoring">
                                    <strong>üîç Initializer Agent</strong>
                                    <small><span class="status-indicator status-monitoring"></span>Status: Monitoring GitHub issues</small>
                                </div>
                                <div class="agent-card available">
                                    <strong>üë®‚Äçüíª Developer Agent</strong>
                                    <small><span class="status-indicator status-available"></span>Status: Ready for tasks</small>
                                </div>
                                <div class="agent-card idle">
                                    <strong>üîç Reviewer Agent</strong>
                                    <small><span class="status-indicator status-idle"></span>Status: Idle</small>
                                </div>
                                <div class="agent-card idle">
                                    <strong>üß™ Tester Agent</strong>
                                    <small><span class="status-indicator status-idle"></span>Status: Awaiting tests</small>
                                </div>
                            </div>
                        </div>
                        
                        <button class="nav-button" data-testid="go-to-alice-button" id="goToAliceBtn">
                            üë©‚Äçüíª Switch to Alice's Dashboard
                        </button>
                        
                        <div class="features">
                            <h3>Bob's Control Systems</h3>
                            <ul>
                                <li>üéõÔ∏è Coordinate multiple Selfie instances across networks</li>
                                <li>üìã Review and approve automated pull requests</li>
                                <li>üìä Monitor development task queues and priorities</li>
                                <li>üîÑ Manage system health and performance metrics</li>
                                <li>üåê Oversee MCP server coordination protocols</li>
                            </ul>
                        </div>
                    </div>
                `;

                this.shadowRoot.getElementById('goToAliceBtn').addEventListener('click', () => {
                    this.classList.add('hidden');
                    document.querySelector('alice-page').classList.remove('hidden');
                    history.pushState(null, '', '/');
                });

                // Update agent status from API
                this.updateAgentStatus();
            }

            async updateAgentStatus() {
                try {
                    const response = await fetch('/api/agents/status');
                    if (response.ok) {
                        const data = await response.json();
                        this.renderAgentCards(data.agents);
                    }
                } catch (error) {
                    console.warn('Could not fetch real-time agent status');
                }
            }

            renderAgentCards(agents) {
                const grid = this.shadowRoot.getElementById('agent-grid');
                const agentEmojis = {
                    'initializer': 'üîç',
                    'developer': 'üë®‚Äçüíª', 
                    'reviewer': 'üîç',
                    'tester': 'üß™'
                };

                grid.innerHTML = agents.map(agent => `
                    <div class="agent-card ${agent.status}">
                        <strong>${agentEmojis[agent.name] || 'ü§ñ'} ${agent.name.charAt(0).toUpperCase() + agent.name.slice(1)} Agent</strong>
                        <small><span class="status-indicator status-${agent.status}"></span>Status: ${agent.status}</small>
                    </div>
                `).join('');
            }
        }

        // Register custom elements
        customElements.define('alice-page', AlicePage);
        customElements.define('bob-page', BobPage);

        // Initialize routing based on URL
        function initializeRouting() {
            const path = window.location.pathname;
            const alicePage = document.querySelector('alice-page');
            const bobPage = document.querySelector('bob-page');

            if (path === '/bob' || path.includes('bob')) {
                alicePage?.classList.add('hidden');
                bobPage?.classList.remove('hidden');
            } else {
                alicePage?.classList.remove('hidden');  
                bobPage?.classList.add('hidden');
            }
        }

        // Handle browser back/forward navigation
        window.addEventListener('popstate', initializeRouting);
        document.addEventListener('DOMContentLoaded', initializeRouting);
    </script>
</body>
</html>